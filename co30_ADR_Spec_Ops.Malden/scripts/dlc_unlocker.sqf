/*-----------------------------------------------------------------
	Author: chasEE
	Version: 0.7
	Desc.: DLC Vehicle Unlocker I made for testing out jets, but modified
	to work all around.
	Notes: UAV's and turrents are not included (but MAY already work).
-----------------------------------------------------------------*/

DLC_Vehicles_Karts = [
"C_Kart_01_F",
"C_Kart_01_blu_F",
"C_Kart_01_Fuel_F",
"C_Kart_01_Red_F",
"C_Kart_01_Vrana_F"
];
DLC_ID_Karts = 288520;

DLC_Vehicles_Helicopters = [
"B_Heli_Transport_03_F",
"B_Heli_Transport_03_unarmed_F",
"O_Heli_Transport_04_F",
"O_Heli_Transport_04_ammo_F",
"O_Heli_Transport_04_bench_F",
"O_Heli_Transport_04_box_F",
"O_Heli_Transport_04_fuel_F",
"O_Heli_Transport_04_medevac_F",
"O_Heli_Transport_04_repair_F",
"O_Heli_Transport_04_covered_F"
];
DLC_ID_Helicopters = 304380;

DLC_Vehicles_Apex = [
"B_CTRG_LSV_01_light_F",
"B_CTRG_Heli_Transport_01_sand_F",
"B_T_Boat_Transport_01_F",
"O_LSV_02_armed_F",
"O_T_APC_Tracked_02_cannon_ghex_F",
"B_CTRG_Heli_Transport_01_tropic_F",
"B_GEN_Offroad_01_gen_F",
"B_LSV_01_armed_F",
"B_LSV_01_unarmed_F",
"B_T_APC_Tracked_01_AA_F",
"B_T_APC_Wheeled_01_cannon_F",
"B_T_APC_Tracked_01_CRV_F",
"B_T_APC_Tracked_01_rcws_F",
"B_T_MBT_01_arty_F",
"B_T_MBT_01_mlrs_F",
"B_T_Lifeboat",
"B_T_Boat_Armed_01_minigun_F",
"B_T_Truck_01_mover_F",
"B_T_Truck_01_ammo_F",
"B_T_Truck_01_box_F",
"B_T_Truck_01_fuel_F",
"B_T_Truck_01_medical_F",
"B_T_Truck_01_Repair_F",
"B_T_Truck_01_transport_F",
"B_T_Truck_01_covered_F",
"B_T_MRAP_01_F",
"B_T_MRAP_01_gmg_F",
"B_T_MRAP_01_hmg_F",
"B_T_LSV_01_armed_F",
"B_T_LSV_01_unarmed_F",
"B_T_Quadbike_01_F",
"B_T_VTOL_01_armed_F",
"B_T_VTOL_01_infantry_F",
"B_T_VTOL_01_vehicle_F",
"B_T_MBT_01_cannon_F",
"B_T_MBT_01_TUSK_F",
"O_LSV_02_unarmed_F",
"O_T_APC_Tracked_02_AA_ghex_F",
"O_T_APC_Wheeled_02_rcws_ghex_F",
"O_T_MBT_02_arty_ghex_F",
"O_T_Boat_Transport_01_F",
"O_T_Lifeboat",
"O_T_Boat_Armed_01_hmg_F",
"O_T_MRAP_02_ghex_F",
"O_T_MRAP_02_gmg_ghex_F",
"O_T_MRAP_02_hmg_ghex_F",
"O_T_LSV_02_armed_F",
"O_T_LSV_02_unarmed_F",
"O_T_Quadbike_01_ghex_F",
"O_T_Truck_03_device_ghex_F",
"O_T_Truck_03_ammo_ghex_F",
"O_T_Truck_03_fuel_ghex_F",
"O_T_Truck_03_medical_ghex_F",
"O_T_Truck_03_repair_ghex_F",
"O_T_Truck_03_transport_ghex_F",
"O_T_Truck_03_covered_ghex_F",
"O_T_VTOL_02_infantry_F",
"O_T_VTOL_02_infantry_dynamicloadout_F",
"O_T_VTOL_02_vehicle_F",
"O_T_VTOL_02_vehicle_dynamicloadout_F",
"O_T_MBT_02_cannon_ghex_F",
"I_C_Boat_Transport_01_F",
"I_C_Boat_Transport_02_F",
"I_C_Offroad_02_unarmed_F",
"I_C_Van_01_transport_F",
"I_C_Heli_Light_01_civil_F",
"I_C_Plane_Civil_01_F",
"C_Boat_Transport_02_F",
"C_Scooter_Transport_01_F",
"C_Offroad_02_unarmed_F",
"C_Plane_Civil_01_F",
"C_Plane_Civil_01_racing_F"
];
DLC_ID_Apex = 395180;

DLC_Vehicles_Jets = [
"B_Plane_Fighter_01_F",
"B_Plane_Fighter_01_Stealth_F",
"O_Plane_Fighter_02_F",
"O_Plane_Fighter_02_Stealth_F",
"I_Plane_Fighter_04_F"
];
// Not the actual Jet's DLC ID but works anyway for now (will need to be updated)
DLC_ID_Jets = 601670;

DLC_Vehicles_Laws_Of_War = [
"B_G_Van_02_vehicle_F",
"B_G_Van_02_transport_F",
"O_G_Van_02_vehicle_F",
"O_G_Van_02_transport_F",
"I_G_Van_02_vehicle_F",
"I_G_Van_02_transport_F",
"I_C_Van_02_vehicle_F",
"I_C_Van_02_transport_F",
"C_Van_02_medevac_F",
"C_Van_02_vehicle_F",
"C_Van_02_service_F",
"C_Van_02_transport_F",
"C_IDAP_Offroad_02_unarmed_F",
"C_IDAP_Offroad_01_F",
"C_IDAP_Van_02_medevac_F",
"C_IDAP_Van_02_vehicle_F",
"C_IDAP_Van_02_transport_F",
"C_IDAP_Truck_02_transport_F",
"C_IDAP_Truck_02_F",
"C_IDAP_Truck_02_water_F",
"C_IDAP_Heli_Transport_02_F"
];
// Laws Of War DLC ID
DLC_ID_Laws_Of_War = 571710;

DLC_Vehicle_List = [];

_ownedDLCs = getDLCs 1;

if !(DLC_ID_Karts in _ownedDLCs) then {
	{
		DLC_Vehicle_List pushBack _x;
	} forEach DLC_Vehicles_Karts;
};

if !(DLC_ID_Helicopters in _ownedDLCs) then {
	{
		DLC_Vehicle_List pushBack _x;
	} forEach DLC_Vehicles_Helicopters;
};

if !(DLC_ID_Apex in _ownedDLCs) then {
	{
		DLC_Vehicle_List pushBack _x;
	} forEach DLC_Vehicles_Apex;
};

if !(DLC_ID_Jets in _ownedDLCs) then {
	{
		DLC_Vehicle_List pushBack _x;
	} forEach DLC_Vehicles_Jets;
};

if !(DLC_ID_Laws_Of_War in _ownedDLCs) then {
	{
		DLC_Vehicle_List pushBack _x;
	} forEach DLC_Vehicles_Laws_Of_War;
};

DLC_Functions_Loop = {
	while {true} do {
		{
			_vehicles = entities _x;
			{
				if ((isNil{_x getVariable "DLC_Var_Active"}) && (alive _x)) then {
					_x setVariable ["DLC_Var_Active",true];
					_x setVariable ["DLC_Var_AddAction_Active",false];
					[_x] spawn DLC_Functions_Handle;
				};
				if (((_x getVariable "DLC_Var_Active") isEqualTo true) && !(alive _x)) then {
					_x setVariable ["DLC_Var_Active",false];
					[_x] call DLC_Functions_RemoveAction;
				};
			} forEach _vehicles;
		} forEach DLC_Vehicle_List;
	sleep 0.1;
	};
};

DLC_Functions_Handle = {
	_vehicle = _this select 0;
	while {(((_vehicle getVariable "DLC_Var_Active") isEqualTo true) && (alive _vehicle))} do {
		_lockedState = locked _vehicle;
		if ((vehicle player != player) && (alive _vehicle)) then {
			[_vehicle] call DLC_Functions_RemoveAction;
		} else {
			if (!(isNull(driver _vehicle)) && ((_vehicle getVariable "DLC_Var_AddAction_Active") isEqualTo true) && ((_vehicle getVariable "DLC_Var_Active") isEqualTo true) && (alive _vehicle)) then {
				[_vehicle] call DLC_Functions_RemoveAction;
			} else {
				if ((vehicle player == player) && ((_vehicle getVariable "DLC_Var_Active") isEqualTo true) && ((_vehicle getVariable "DLC_Var_AddAction_Active") isEqualTo false) && (alive _vehicle) && (((_lockedState == 2) or (_lockedstate == 3)) isEqualTo false)) then {
				[_vehicle] call DLC_Functions_AddAction;
				} else {
					if ((vehicle player == player) && ((_vehicle getVariable "DLC_Var_Active") isEqualTo true) && ((_vehicle getVariable "DLC_Var_AddAction_Active") isEqualTo true) && (alive _vehicle) && (((_lockedState == 2) or (_lockedstate == 3)) isEqualTo true)) then {
					[_vehicle] call DLC_Functions_RemoveAction;
					};
				};
			};
		};
		sleep 0.1;
	};
};

DLC_Functions_AddAction = {
	_vehicle = _this select 0;
	_type = (typeOf (vehicle _vehicle));
	_config  = (configFile >>  "CfgVehicles" >>  _type);
	_displayVehicle = if (isText(_config >> "displayName")) then {getText(_config >> "displayName")};
	_displayVehicle = "<t color='#FFFF00'>" + _displayVehicle + "<t/>";
	DLC_AddAction_1 = _vehicle addAction ["<t color='#FF0000'>"+(localize "STR_Misc_Getin")+"<t/> " + _displayVehicle + " <t color='#FF0000'>"+(localize "STR_Misc_NoDLC")+"</t>",{player moveInDriver (_this select 0)},[],1,false,true,"","_this distance _target < 8"];
	_vehicle setVariable ["DLC_Var_AddAction_Active",true];
	_vehicle setVariable ["DLC_Var_AddAction_Number",DLC_AddAction_1];
};

DLC_Functions_RemoveAction = {
	_vehicle = _this select 0;
	_action = _vehicle getVariable ["DLC_Var_AddAction_Number", false];
	if (_action) then {
	    _vehicle removeAction _action;
	    _vehicle setVariable ["DLC_Var_AddAction_Active", false];
    };
};

[] spawn DLC_Functions_Loop;